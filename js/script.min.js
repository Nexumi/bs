!function(){"use strict";function person(e,t,l){this.name=e,this.pritem=[[t,l]]}let rows=document.getElementsByClassName("row_wrapper")[0],extra=document.getElementsByClassName("extra")[0],result=document.getElementsByClassName("result")[0],tax_mode="$",tip_mode="$";function getParams(){let urlParams=new URLSearchParams(window.location.search),params=["names","prices","items","extra"];for(let i=0;i<params.length;i++){let param=params[i];try{var get=eval(urlParams.get(param))}catch(tobe){continue}if(null!==get){if("extra"===param){let inputs=extra.getElementsByTagName("input");4===get.length?("%"===get[0]&&(tax_mode="%",inputs[0].style.display="none",inputs[2].style.display="inline-block"),inputs[1].value=get[1],"%"===get[2]&&(tip_mode="%",inputs[3].style.display="none",inputs[5].style.display="inline-block"),inputs[4].value=get[3]):(tax_mode="%",inputs[0].style.display="none",inputs[2].style.display="inline-block",inputs[1].value=get[0]||"",inputs[4].value=get[1]||"")}else{let inputs=rows.children;for(let j=0;j<get.length;j++)inputs[j+1].children[i].value=get[j],void 0===inputs[j+2]&&createInput()}}}let legacyParams=["sitems","sprices","exclude"],inputs=rows.children,count=inputs.length;for(let i=0;i<legacyParams.length;i++){let param=legacyParams[i];try{var get=eval(urlParams.get(param))}catch(tobe){continue}if(null!==get){if("sitems"===param)var getLength=get.length;for(let j=0;j<getLength;j++){let input=inputs[count-1+j].children;switch(param){case"sitems":input[2].value=get[j];break;case"sprices":input[1].value=get[j];break;case"exclude":get[j]=invertExclude(get[j]||""),input[0].value=get[j]}void 0===inputs[count-1+j+1]&&createInput()}}}}function scannedReceipt(e){let{products:t,tax:l,tip:n}=e,i=rows.children,a=extra.getElementsByTagName("input")[1],r=extra.getElementsByTagName("input")[4];for(let c of t){if(void 0!==c.type&&[null,"discount"].includes(c.type))continue;let s=i[i.length-1],u=s.children[1],o=s.children[2],{description:d,total:h}=c;u.value=h,o.value=d,createInput()}a.value=l,r.value=n,calculate()}function share(){let e=[],t=["names","prices","items","extra"];for(let l=0;l<t.length;l++){let n=t[l],i;if("extra"===n){let a=extra.getElementsByTagName("input");i=[],"inline-block"===getComputedStyle(a[0]).display?i.push("%27$%27"):i.push("%27%25%27"),i.push("%27"+a[1].value+"%27"),"inline-block"===getComputedStyle(a[3]).display?i.push("%27$%27"):i.push("%27%25%27"),i.push("%27"+a[4].value+"%27")}else{let r=rows.children;i=[];for(var c=1;c<r.length;c++)i.push("%27"+r[c].children[l].value.replaceAll(" ","%20")+"%27")}if("extra"!==n)for(var c=i.length-1;c>=0;c--)if("%27%27"===i[c])i.pop();else break;!(!i.length||"extra"===n&&["%27$%27","%27%27","%27$%27","%27%27"].every((e,t)=>e===i[t]))&&e.push(n+"=%5B"+i+"%5D")}if(!e.length){navigator.clipboard.writeText(window.location.origin);return}apiShort(window.location.origin+"?"+e.join("&"))}function createInput(){let e=document.createElement("div");e.classList.add("row");let t=document.createElement("input");t.setAttribute("type","text"),e.appendChild(t),(t=document.createElement("input")).setAttribute("type","text"),e.appendChild(t),(t=document.createElement("input")).setAttribute("type","text"),e.appendChild(t),rows.appendChild(e)}function destroyInput(e=rows.children.length-1){rows.children.length>1&&rows.children[e].remove()}function deleteHbr(){for(let e=1;e<=6;e++){let t=result.getElementsByTagName("h"+e),l=t.length;for(let n=0;n<l;n++)t[0].remove()}let i=result.getElementsByTagName("br"),a=i.length;for(let r=0;r<a;r++)i[0].remove()}function peopleFind(e,t){for(let l=0;l<e.length;l++)if(e[l].name===t)return l;return -1}function itemFind(e,t){for(let l=0;l<e.length;l++)if(e[l][1]===t)return l;return -1}function invertExclude(e){(e=e.split(", ")).push("");let t=rows.children,l=[];for(let n=1;n<t.length;n++){let i=t[n].children[0];i.value.includes(", ")||e.includes(i.value)||l.push(i.value)}return l.join(", ")}function peopleCreate(){let peep=[],row=rows.children;for(let i=0;i<row.length;i++)try{let inputs=row[i].children,nameInput=inputs[0],priceInput=inputs[1],itemInput=inputs[2],name=nameInput.value.replace(",",", ").replace(/\s+/g," ").trim(),price=priceInput.value.replace(/\s+/g," ").trim(),item=itemInput.value.replace(/\s+/g," ").trim();if(nameInput!==document.activeElement&&(nameInput.value=name),priceInput!==document.activeElement&&(priceInput.value=price),itemInput!==document.activeElement&&(itemInput.value=item),price=eval(price),"number"==typeof price&&(price=Number(price.toFixed(2))),!isNaN(price)){priceInput!==document.activeElement&&(priceInput.value=price.toFixed(2));let splitNames=name.split(", ");for(let j=0;j<splitNames.length;j++){let find=peopleFind(peep,splitNames[j]);if(-1!==find){let pritem=peep[find].pritem,pfit=itemFind(pritem,item+(splitNames.length>1?" [Split]":""));-1!==pfit?pritem[pfit][0]+=price/splitNames.length:pritem.push([price/splitNames.length,item+(splitNames.length>1?" [Split]":"")])}else peep.push(new person(splitNames[j],price/splitNames.length,item+(splitNames.length>1?" [Split]":"")))}}}catch(ignore){}let i=1;for(;i<row.length-1;){let inputs=row[i].children,nameInput=inputs[0],priceInput=inputs[1],itemInput=inputs[2];nameInput.value.length||nameInput===document.activeElement||priceInput.value.length||priceInput===document.activeElement||itemInput.value.length||itemInput===document.activeElement?i++:destroyInput(i)}let lastRow=row[row.length-1].children;for(let input of lastRow)if(input.value.length){createInput();break}return peep}function costH(peep){let ex=extra.getElementsByTagName("input"),tax,tip;try{tax=eval(ex[1].value),"number"==typeof tax&&("$"===tax_mode&&(tax=tax.toFixed(2)),document.activeElement!==ex[1]&&(ex[1].value=tax)),"%"===tax_mode&&(tax/=100)}catch(what){tax=NaN}try{tip=eval(ex[4].value),"number"==typeof tip&&("$"===tip_mode&&(tip=tip.toFixed(2)),document.activeElement!==ex[4]&&(ex[4].value=tip)),"%"===tip_mode&&(tip/=100)}catch(what){tip=NaN}let subtotal=0;for(let i=0;i<peep.length;i++){let pricy=peep[i].pritem;for(let j=0;j<pricy.length;j++){let price=pricy[j][0];isNaN(price)||(subtotal+=price)}}tax=Number(tax)||0,"%"===tax_mode&&(tax*=subtotal),tip=Number(tip)||0,"%"===tip_mode&&(tip*=subtotal);let total=subtotal+tax,trueTotal=total+tip,h3=extra.getElementsByTagName("h3");h3[0].innerText="Subtotal: $"+subtotal.toFixed(2),"$"===tax_mode?h3[2].innerText="Tax: "+(Number((tax/subtotal*100).toFixed(2))||0)+"%":h3[2].innerText="Tax: $"+tax.toFixed(2),h3[3].innerText="Total: $"+total.toFixed(2),"$"===tip_mode?h3[5].innerText="Tip: "+(Number((tip/subtotal*100).toFixed(2))||0)+"%":h3[5].innerText="Tip: $"+tip.toFixed(2),h3[6].innerText="True Total: $"+trueTotal.toFixed(2)}function individualH(peep){let ex=extra.getElementsByTagName("input"),ext=extra.getElementsByTagName("h3"),tax,tip;try{tax=eval(ex[1].value)||0,"%"===tax_mode&&(tax/=100)}catch(what){tax=0}try{tip=eval(ex[4].value)||0,"%"===tip_mode&&(tip/=100)}catch(what){tip=0}"$"===tax_mode&&(tax/=ext[0].innerText.slice(11)),"$"===tip_mode&&(tip/=ext[0].innerText.slice(11));for(let i=0;i<peep.length;i++){if(!peep[i].name)continue;let price=0,pricy=peep[i].pritem;for(let j=0;j<pricy.length;j++){let subprice=pricy[j][0];isNaN(subprice)||(price+=subprice)}let h3=document.createElement("h3");h3.innerText=peep[i].name+": $"+(price+price*tax+price*tip).toFixed(2),result.appendChild(h3);let h5=document.createElement("h5");h5.innerText="  Tax: $"+(price*tax).toFixed(2),result.appendChild(h5),(h5=document.createElement("h5")).innerText="  Tip: $"+(price*tip).toFixed(2),result.appendChild(h5);for(let j=0;j<pricy.length;j++){let subitem=pricy[j];!isNaN(subitem[0])&&subitem[1].length&&((h5=document.createElement("h5")).innerText="  "+subitem[1]+": $"+subitem[0].toFixed(2),result.appendChild(h5))}}}function calculate(){deleteHbr();let e=peopleCreate();costH(e),individualH(e)}function setButtonEventListners(){let e=document.getElementById("tax_dollar"),t=document.getElementById("tax_percent"),l=document.getElementById("tip_dollar"),n=document.getElementById("tip_percent");e.addEventListener("click",function(){tax_mode="%",e.style.display="none",t.style.display="inline-block"}),t.addEventListener("click",function(){tax_mode="$",t.style.display="none",e.style.display="inline-block"}),l.addEventListener("click",function(){tip_mode="%",l.style.display="none",n.style.display="inline-block"}),n.addEventListener("click",function(){tip_mode="$",n.style.display="none",l.style.display="inline-block"})}function setEventListeners(){document.getElementById("file").addEventListener("change",apiReceipt),document.getElementById("share").addEventListener("click",share),document.addEventListener("focusout",calculate),document.addEventListener("input",calculate),setButtonEventListners()}window.scannedReceipt=function(e){scannedReceipt(e)},createInput(),getParams(),setEventListeners(),calculate()}();