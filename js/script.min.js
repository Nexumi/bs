!function(){"use strict";function person(e,t,l){this.name=e,this.pritem=[[t,l]]}let column=document.getElementsByClassName("column"),names=column[0],prices=column[1],items=column[2],extra=document.getElementsByClassName("extra")[0],result=document.getElementsByClassName("result")[0],tax_mode="$",tip_mode="$";function getParams(){let urlParams=new URLSearchParams(window.location.search),params=["names","prices","items","extra"];for(let i=0;i<params.length;i++){let param=params[i];try{var get=eval(urlParams.get(param))}catch(tobe){continue}if(null!==get){let inputs=eval(param+".getElementsByTagName('input')");if("extra"===param)4===get.length?("%"===get[0]&&(tax_mode="%",inputs[0].style.display="none",inputs[2].style.display="inline-block"),inputs[1].value=get[1],"%"===get[2]&&(tip_mode="%",inputs[3].style.display="none",inputs[5].style.display="inline-block"),inputs[4].value=get[3]):(tax_mode="%",inputs[0].style.display="none",inputs[2].style.display="inline-block",inputs[1].value=get[0]||"",inputs[4].value=get[1]||"");else for(let j=0;j<get.length;j++)inputs[j].value=get[j],void 0===inputs[j+1]&&createInput()}}let legacyParams=["sitems","sprices","exclude"];for(let i=0;i<legacyParams.length;i++){let param=legacyParams[i];try{var get=eval(urlParams.get(param))}catch(tobe){continue}if(null!==get){let inputs;switch(param){case"sitems":var count=(inputs=items.getElementsByTagName("input")).length,getLength=get.length;break;case"sprices":inputs=prices.getElementsByTagName("input");break;case"exclude":inputs=names.getElementsByTagName("input")}for(let j=0;j<getLength;j++)"exclude"===param&&(get[j]=invertExclude(get[j]||"")),inputs[count-1+j].value=get[j],void 0===inputs[count-1+j+1]&&createInput()}}}function share(){let link="?",yes=!1,params=["names","prices","items","extra"];for(let i=0;i<params.length;i++){let param=params[i],inputs=eval(param+".getElementsByTagName('input')"),makeParam;if("extra"===param)makeParam=[],"inline-block"===getComputedStyle(inputs[0]).display?makeParam.push("%27$%27"):makeParam.push("%27%25%27"),makeParam.push("%27"+inputs[1].value+"%27"),"inline-block"===getComputedStyle(inputs[3]).display?makeParam.push("%27$%27"):makeParam.push("%27%25%27"),makeParam.push("%27"+inputs[4].value+"%27");else{makeParam=[];for(var j=0;j<inputs.length;j++)makeParam.push("%27"+inputs[j].value.replaceAll(" ","%20")+"%27")}if("extra"!==param)for(var j=makeParam.length-1;j>=0;j--)if("%27%27"===makeParam[j])makeParam.pop();else break;if(makeParam.length)yes?link+="&":yes=!0,!("extra"===param&&["%27$%27","%27%27","%27$%27","%27%27"].every((e,t)=>e===makeParam[t]))&&(link+=param+"=%5B"+makeParam+"%5D")}if(1===link.length){navigator.clipboard.writeText(window.location.origin);return}apiShort(window.location.origin+link)}function createInput(){let e=document.createElement("input");e.setAttribute("type","text"),names.appendChild(e),(e=document.createElement("input")).setAttribute("type","text"),prices.appendChild(e),(e=document.createElement("input")).setAttribute("type","text"),items.appendChild(e)}function destroyInput(e=nameInputs.length-1){let t=names.getElementsByTagName("input"),l=prices.getElementsByTagName("input"),n=items.getElementsByTagName("input");t[e].remove(),l[e].remove(),n[e].remove()}function deleteHbr(){for(let e=1;e<=6;e++){let t=result.getElementsByTagName("h"+e),l=t.length;for(let n=0;n<l;n++)t[0].remove()}let i=result.getElementsByTagName("br"),a=i.length;for(let u=0;u<a;u++)i[0].remove()}function peopleFind(e,t){for(let l=0;l<e.length;l++)if(e[l].name===t)return l;return -1}function itemFind(e,t){for(let l=0;l<e.length;l++)if(e[l][1]===t)return l;return -1}function invertExclude(e){(e=e.split(", ")).push("");let t=names.getElementsByTagName("input"),l=[];for(let n=0;n<t.length;n++)t[n].value.includes(", ")||e.includes(t[n].value)||l.push(t[n].value);return l.join(", ")}function peopleCreate(){let peep=[],nameInputs=names.getElementsByTagName("input"),priceInputs=prices.getElementsByTagName("input"),itemInputs=items.getElementsByTagName("input");for(let i=0;i<nameInputs.length;i++)try{let name=nameInputs[i].value.replace(",",", ").replace(/\s+/g," ").trim(),price=priceInputs[i].value.replace(/\s+/g," ").trim(),item=itemInputs[i].value.replace(/\s+/g," ").trim();if(nameInputs[i]!==document.activeElement&&(nameInputs[i].value=name),priceInputs[i]!==document.activeElement&&(priceInputs[i].value=price),itemInputs[i]!==document.activeElement&&(itemInputs[i].value=item),price=eval(price),"number"==typeof price&&(price=Number(price.toFixed(2))),!isNaN(price)){priceInputs[i]!==document.activeElement&&(priceInputs[i].value=price.toFixed(2));let splitNames=name.split(", ");for(let j=0;j<splitNames.length;j++){let find=peopleFind(peep,splitNames[j]);if(-1!==find){let pritem=peep[find].pritem,pfit=itemFind(pritem,item+(splitNames.length>1?" [Split]":""));-1!==pfit?pritem[pfit][0]+=price/splitNames.length:pritem.push([price/splitNames.length,item+(splitNames.length>1?" [Split]":"")])}else peep.push(new person(splitNames[j],price/splitNames.length,item+(splitNames.length>1?" [Split]":"")))}}}catch(ignore){}let i=0;for(;i<nameInputs.length-1;)nameInputs[i].value.length||nameInputs[i]===document.activeElement||priceInputs[i].value.length||priceInputs[i]===document.activeElement||itemInputs[i].value.length||itemInputs[i]===document.activeElement?i++:destroyInput(i);return(nameInputs[nameInputs.length-1].value.length||priceInputs[priceInputs.length-1].value.length||itemInputs[itemInputs.length-1].value.length)&&createInput(),peep}function costH(peep){let ex=extra.getElementsByTagName("input"),tax,tip;try{tax=eval(ex[1].value),"number"==typeof tax&&("$"===tax_mode&&(tax=Number(tax.toFixed(2))),document.activeElement!==ex[1]&&(ex[1].value=tax)),"%"===tax_mode&&(tax/=100)}catch(what){tax=NaN}try{tip=eval(ex[4].value),"number"==typeof tip&&("$"===tip_mode&&(tip=Number(tip.toFixed(2))),document.activeElement!==ex[4]&&(ex[4].value=tip)),"%"===tip_mode&&(tip/=100)}catch(what){tip=NaN}let subtotal=0;for(let i=0;i<peep.length;i++){let pricy=peep[i].pritem;for(let j=0;j<pricy.length;j++){let price=pricy[j][0];isNaN(price)||(subtotal+=price)}}tax=tax||0,"%"===tax_mode&&(tax*=subtotal),tip=tip||0,"%"===tip_mode&&(tip*=subtotal);let total=subtotal+tax,trueTotal=total+tip,h3=extra.getElementsByTagName("h3");h3[0].innerText="Subtotal: $"+subtotal.toFixed(2),"$"===tax_mode?h3[2].innerText="Tax: "+(Number((tax/subtotal*100).toFixed(2))||0)+"%":h3[2].innerText="Tax: $"+tax.toFixed(2),h3[3].innerText="Total: $"+total.toFixed(2),"$"===tip_mode?h3[5].innerText="Tip: "+(Number((tip/subtotal*100).toFixed(2))||0)+"%":h3[5].innerText="Tip: $"+tip.toFixed(2),h3[6].innerText="True Total: $"+trueTotal.toFixed(2)}function individualH(peep){let ex=extra.getElementsByTagName("input"),ext=extra.getElementsByTagName("h3"),tax,tip;try{tax=eval(ex[1].value)||0,"%"===tax_mode&&(tax/=100)}catch(what){tax=0}try{tip=eval(ex[4].value)||0,"%"===tip_mode&&(tip/=100)}catch(what){tip=0}"$"===tax_mode&&(tax/=ext[0].innerText.slice(11)),"$"===tip_mode&&(tip/=ext[0].innerText.slice(11));for(let i=0;i<peep.length;i++){if(!peep[i].name)continue;let price=0,pricy=peep[i].pritem;for(let j=0;j<pricy.length;j++){let subprice=pricy[j][0];isNaN(subprice)||(price+=subprice)}let h3=document.createElement("h3");h3.innerText=peep[i].name+": $"+(price+price*tax+price*tip).toFixed(2),result.appendChild(h3);let h5=document.createElement("h5");h5.innerText="  Tax: $"+(price*tax).toFixed(2),result.appendChild(h5),(h5=document.createElement("h5")).innerText="  Tip: $"+(price*tip).toFixed(2),result.appendChild(h5);for(let j=0;j<pricy.length;j++){let subitem=pricy[j];!isNaN(subitem[0])&&subitem[1].length&&((h5=document.createElement("h5")).innerText="  "+subitem[1]+": $"+subitem[0].toFixed(2),result.appendChild(h5))}}}function calculate(){deleteHbr();let e=peopleCreate();costH(e),individualH(e)}function setButtonEventListners(){let e=document.getElementById("tax_dollar"),t=document.getElementById("tax_percent"),l=document.getElementById("tip_dollar"),n=document.getElementById("tip_percent");e.addEventListener("click",function(){tax_mode="%",e.style.display="none",t.style.display="inline-block"}),t.addEventListener("click",function(){tax_mode="$",t.style.display="none",e.style.display="inline-block"}),l.addEventListener("click",function(){tip_mode="%",l.style.display="none",n.style.display="inline-block"}),n.addEventListener("click",function(){tip_mode="$",n.style.display="none",l.style.display="inline-block"})}function setEventListeners(){document.getElementById("file").onchange=apiReceipt,document.getElementById("share").addEventListener("click",share),document.addEventListener("focusout",calculate),document.addEventListener("input",calculate),setButtonEventListners()}window.scannedReceipt=function(e){let{products:t,tax:l,tip:n}=e,i=prices.getElementsByTagName("input"),a=items.getElementsByTagName("input"),u=extra.getElementsByTagName("input")[1],r=extra.getElementsByTagName("input")[4];for(let s of t){if(void 0!==s.type&&[null,"discount"].includes(s.type))continue;let{description:o,total:c}=s;i[i.length-1].value=c,a[a.length-1].value=o,createInput()}u.value=l,r.value=n,calculate()},createInput(),getParams(),setEventListeners(),calculate()}();