!function(){"use strict";function person(e,t,n){this.name=e,this.pritem=[[t,n]]}let rows=document.getElementsByClassName("row_wrapper")[0],extra=document.getElementsByClassName("extra")[0],result=document.getElementsByClassName("result")[0],tax_mode="$",tip_mode="$",fee_mode="$";function getParams(url=window.location.search){let urlParams=new URLSearchParams(url),params=["names","prices","items","extra"];for(let i=0;i<params.length;i++){let param=params[i];try{var get=eval(urlParams.get(param))}catch(tobe){continue}if(null!==get){if("extra"===param){let inputs=extra.getElementsByTagName("input");6===get.length?("%"===get[0]&&(fee_mode="%",inputs[0].classList.add("hidden"),inputs[2].classList.remove("hidden")),inputs[1].value=get[1],"%"===get[2]&&(tax_mode="%",inputs[3].classList.add("hidden"),inputs[5].classList.remove("hidden")),inputs[4].value=get[3],"%"===get[4]&&(tip_mode="%",inputs[6].classList.add("hidden"),inputs[8].classList.remove("hidden")),inputs[7].value=get[5]):4===get.length?("%"===get[0]&&(tax_mode="%",inputs[3].classList.add("hidden"),inputs[5].classList.remove("hidden")),inputs[4].value=get[1],"%"===get[2]&&(tip_mode="%",inputs[6].classList.add("hidden"),inputs[8].classList.remove("hidden")),inputs[7].value=get[3]):(tax_mode="%",inputs[0].classList.add("hidden"),inputs[2].classList.remove("hidden"),inputs[1].value=get[0]||"",inputs[4].value=get[1]||"")}else{let inputs=rows.children;for(let j=0;j<get.length;j++)inputs[j+1].children[i].value=get[j],void 0===inputs[j+2]&&createInput()}}}let legacyParams=["sitems","sprices","exclude"],inputs=rows.children,count=inputs.length;for(let i=0;i<legacyParams.length;i++){let param=legacyParams[i];try{var get=eval(urlParams.get(param))}catch(tobe){continue}if(null!==get){if("sitems"===param)var getLength=get.length;for(let j=0;j<getLength;j++){let input=inputs[count-1+j].children;switch(param){case"sitems":input[2].value=get[j];break;case"sprices":input[1].value=get[j];break;case"exclude":get[j]=invertExclude(get[j]||""),input[0].value=get[j]}void 0===inputs[count-1+j+1]&&createInput()}}}}function scannedReceipt(e){let{products:t,tax:n,tip:l}=e,i=rows.children,a=extra.getElementsByTagName("input")[4],s=extra.getElementsByTagName("input")[7];for(let d of t){if(void 0!==d.type&&[null,"discount"].includes(d.type))continue;let r=i[i.length-1],c=r.children[1],u=r.children[2],{description:h,total:o}=d;c.value=o,u.value=h,createInput()}a.value=n,s.value=l,calculate()}function share(){let e=[],t=["names","prices","items","extra"];for(let n=0;n<t.length;n++){let l=t[n],i;if("extra"===l){let a=extra.getElementsByTagName("input");i=[],a[2].classList.contains("hidden")?i.push(encodeURIComponent('"$"')):i.push(encodeURIComponent('"%"')),i.push(encodeURIComponent('"'+a[1].value+'"')),a[5].classList.contains("hidden")?i.push(encodeURIComponent('"$"')):i.push(encodeURIComponent('"%"')),i.push(encodeURIComponent('"'+a[4].value+'"')),a[8].classList.contains("hidden")?i.push(encodeURIComponent('"$"')):i.push(encodeURIComponent('"%"')),i.push(encodeURIComponent('"'+a[7].value+'"'))}else{let s=rows.children;i=[];for(var d=1;d<s.length;d++)i.push(encodeURIComponent('"'+s[d].children[n].value+'"'))}if("extra"!==l)for(var d=i.length-1;d>=0;d--)if("%22%22"===i[d])i.pop();else break;!(!i.length||"extra"===l&&["%22%24%22","%22%22","%22%24%22","%22%22","%22%24%22","%22%22"].every((e,t)=>e===i[t]))&&e.push(l+"=%5B"+i+"%5D")}apiShort(window.location.origin+"?"+e.join("&"))}function createInput(){let e=document.createElement("div");e.classList.add("row");let t=document.createElement("input");t.setAttribute("type","text"),e.appendChild(t),(t=document.createElement("input")).setAttribute("type","text"),e.appendChild(t),(t=document.createElement("input")).setAttribute("type","text"),e.appendChild(t),rows.appendChild(e)}function destroyInput(e=rows.children.length-1){rows.children.length>1&&rows.children[e].remove()}function deleteHbr(){for(let e=1;e<=6;e++){let t=result.getElementsByTagName("h"+e),n=t.length;for(let l=0;l<n;l++)t[0].remove()}let i=result.getElementsByTagName("br"),a=i.length;for(let s=0;s<a;s++)i[0].remove()}function peopleFind(e,t){for(let n=0;n<e.length;n++)if(e[n].name===t)return n;return -1}function itemFind(e,t){for(let n=0;n<e.length;n++)if(e[n][1]===t)return n;return -1}function invertExclude(e){(e=e.split(", ")).push("");let t=rows.children,n=[];for(let l=1;l<t.length;l++){let i=t[l].children[0];i.value.includes(", ")||e.includes(i.value)||n.push(i.value)}return n.join(", ")}function peopleCreate(){let peep=[],row=rows.children;for(let i=0;i<row.length;i++)try{let inputs=row[i].children,nameInput=inputs[0],priceInput=inputs[1],itemInput=inputs[2],name=nameInput.value.replaceAll(",",", ").replace(/\s+/g," ").trim(),price=priceInput.value.replace(/\s+/g," ").trim(),item=itemInput.value.replace(/\s+/g," ").trim();if(nameInput!==document.activeElement&&(nameInput.value=name),priceInput!==document.activeElement&&(priceInput.value=price),itemInput!==document.activeElement&&(itemInput.value=item),price=eval(price),"number"==typeof price&&(price=Number(price.toFixed(2))),!isNaN(price)){priceInput!==document.activeElement&&(priceInput.value=price.toFixed(2));let splitNames=name.split(", ");for(let j=0;j<splitNames.length;j++){let find=peopleFind(peep,splitNames[j]),label=item+(splitNames.length>1?" [Split]":""),finalPrice=price/splitNames.length;if(-1!==find){let pritem=peep[find].pritem,pfit=itemFind(pritem,label);-1!==pfit?pritem[pfit][0]+=finalPrice:pritem.push([finalPrice,label])}else peep.push(new person(splitNames[j],finalPrice,label))}}}catch(ignore){}let i=1;for(;i<row.length-1;){let inputs=row[i].children,nameInput=inputs[0],priceInput=inputs[1],itemInput=inputs[2];nameInput.value.length||nameInput===document.activeElement||priceInput.value.length||priceInput===document.activeElement||itemInput.value.length||itemInput===document.activeElement?i++:destroyInput(i)}let lastRow=row[row.length-1].children;for(let input of lastRow)if(input.value.length){createInput();break}return peep}function costH(peep){let ex=extra.getElementsByTagName("input"),fee,tax,tip;try{fee=eval(ex[1].value),"number"==typeof fee&&("$"===fee_mode&&(fee=fee.toFixed(2)),document.activeElement!==ex[1]&&(ex[1].value=fee)),"%"===fee_mode&&(fee/=100)}catch(what){tip=NaN}try{tax=eval(ex[4].value),"number"==typeof tax&&("$"===tax_mode&&(tax=tax.toFixed(2)),document.activeElement!==ex[4]&&(ex[4].value=tax)),"%"===tax_mode&&(tax/=100)}catch(what){tax=NaN}try{tip=eval(ex[7].value),"number"==typeof tip&&("$"===tip_mode&&(tip=tip.toFixed(2)),document.activeElement!==ex[7]&&(ex[7].value=tip)),"%"===tip_mode&&(tip/=100)}catch(what){tip=NaN}let subtotal=0;for(let i=0;i<peep.length;i++){let pricy=peep[i].pritem;for(let j=0;j<pricy.length;j++){let price=pricy[j][0];isNaN(price)||(subtotal+=price)}}fee=Number(fee)||0,"%"===fee_mode&&(fee*=subtotal),tax=Number(tax)||0,"%"===tax_mode&&(tax*=subtotal),tip=Number(tip)||0,"%"===tip_mode&&(tip*=subtotal);let total=subtotal+fee+tax,trueTotal=total+tip,h2=extra.getElementsByTagName("h2"),h3=extra.getElementsByTagName("h3");h2[0].innerText="Subtotal: $"+subtotal.toFixed(2),"$"===fee_mode?h3[1].innerText="Fee: "+(Number((fee/subtotal*100).toFixed(2))||0)+"%":h3[1].innerText="Fee: $"+fee.toFixed(2),"$"===tax_mode?h3[3].innerText="Tax: "+(Number((tax/subtotal*100).toFixed(2))||0)+"%":h3[3].innerText="Tax: $"+tax.toFixed(2),h2[1].innerText="Total: $"+total.toFixed(2),"$"===tip_mode?h3[5].innerText="Tip: "+(Number((tip/subtotal*100).toFixed(2))||0)+"%":h3[5].innerText="Tip: $"+tip.toFixed(2),h2[2].innerText="True Total: $"+trueTotal.toFixed(2)}function individualH(peep){let ex=extra.getElementsByTagName("input"),ext=extra.getElementsByTagName("h2"),fee,tax,tip;try{fee=eval(ex[1].value)||0,"%"===tax_mode&&(fee/=100)}catch(what){fee=0}try{tax=eval(ex[4].value)||0,"%"===tax_mode&&(tax/=100)}catch(what){tax=0}try{tip=eval(ex[7].value)||0,"%"===tip_mode&&(tip/=100)}catch(what){tip=0}"$"===fee_mode&&(fee/=ext[0].innerText.slice(11)),"$"===tax_mode&&(tax/=ext[0].innerText.slice(11)),"$"===tip_mode&&(tip/=ext[0].innerText.slice(11));for(let i=0;i<peep.length;i++){if(!peep[i].name)continue;let price=0,pricy=peep[i].pritem;for(let j=0;j<pricy.length;j++){let subprice=pricy[j][0];isNaN(subprice)||(price+=subprice)}let h3=document.createElement("h3");h3.innerText=peep[i].name+": $"+(price+price*tax+price*tip).toFixed(2),result.appendChild(h3);let h5=document.createElement("h5");h5.innerText="  Tax: $"+(price*tax).toFixed(2),result.appendChild(h5),(h5=document.createElement("h5")).innerText="  Tip: $"+(price*tip).toFixed(2),result.appendChild(h5);for(let j=0;j<pricy.length;j++){let subitem=pricy[j];!isNaN(subitem[0])&&subitem[1].length&&((h5=document.createElement("h5")).innerText="  "+subitem[1]+": $"+subitem[0].toFixed(2),result.appendChild(h5))}}}function calculate(){let e=window.scrollY;deleteHbr();let t=peopleCreate();costH(t),individualH(t),window.scrollTo(0,e)}function parseURL(e){if(e&&["names=","prices=","items=","extra=","sitems=","sprices=","exclude="].some((t,n)=>e.includes(t))){for(;rows.children.length>2;)destroyInput(1);let t=e.indexOf("?");getParams(e.slice(-1===t?0:t)),calculate()}}function setButtonEventListners(){let e=document.getElementById("file"),t=document.getElementById("custom_file"),n=document.getElementById("load_url"),l=document.getElementById("fee_dollar"),i=document.getElementById("fee_percent"),a=document.getElementById("tax_dollar"),s=document.getElementById("tax_percent"),d=document.getElementById("tip_dollar"),r=document.getElementById("tip_percent");t.addEventListener("click",function(){e.click()}),n.addEventListener("click",function(){let e=prompt("Enter URL");e&&(e.includes("short.jpkit.us")?apiExpandShort(e):parseURL(e))}),l.addEventListener("click",function(){fee_mode="%",l.classList.add("hidden"),i.classList.remove("hidden"),calculate()}),i.addEventListener("click",function(){fee_mode="$",i.classList.add("hidden"),l.classList.remove("hidden"),calculate()}),a.addEventListener("click",function(){tax_mode="%",a.classList.add("hidden"),s.classList.remove("hidden"),calculate()}),s.addEventListener("click",function(){tax_mode="$",s.classList.add("hidden"),a.classList.remove("hidden"),calculate()}),d.addEventListener("click",function(){tip_mode="%",d.classList.add("hidden"),r.classList.remove("hidden"),calculate()}),r.addEventListener("click",function(){tip_mode="$",r.classList.add("hidden"),d.classList.remove("hidden"),calculate()})}function setEventListeners(){document.getElementById("file").addEventListener("change",apiReceipt),document.getElementById("share").addEventListener("click",share),document.addEventListener("focusout",calculate),document.addEventListener("input",calculate),setButtonEventListners()}window.scannedReceipt=function(e){scannedReceipt(e)},window.parseURL=function(e){parseURL(e)},createInput(),getParams(),setEventListeners(),calculate()}();